# scMINER
## single-cell Mutual Information Network Engineered Ranger

scMINER is a toolbox for single-cell analysis based on mutual information. This package is a combination of several individual tools including but not limited to MIE and MICA. Other tools including network construction, master regultors identification and activity based analysis may be added. MIE is the baseline of the package and the other tools require the output of MIE tool. MICA in this package has been improved and the main advantage of that is parallelism using St. Jude research cluster and Phoenix application.

## Download

<code>git clone https://github.com/jyyulab/scMINER.git</code>

## Starting Point

To start using the package on St. Jude research cluster (by default), follow the below steps:

### Phoenix Setup

In St. Jude's Research Cluster, Phoenix is accessible via:

<code>setcbenv prod</code></br>
<code>set official</code></br>
<code>cbload phoenix</code>

And the following two environment variables for scMINER:

### Setup scMINER

Set the two environment variables as follows:

<code>export PYTHON_PATH=[path_to_target_python3]</code>
</br>
<code>export scMINER_PATH=[path_to_root_directory_of_scMINER]</code>

### Setup R

To generate R plot load R module as follows:

<code>module load R/3.4.0</code>

To use the package in a regular machine, just follow Setup scMINER section and make sure to have R and requirement Python packages installed and when running any command set the --host option to LOCAL.

## Run MIE

To run MIE, simply follow the following example:

<code>python3 scMINER.py MIE Pipeline [project_name] [input_tab_separated_file] [output_dir] [output_file_name]</code>

To avoid memory issue in case that the input file is large, make sure to use bsub on research cluster.

## Run MICA

To run MICA in clustering mode, simply follow the following example:

<code>python3 scMINER.py MICA Clust [project_name] [path_to: project_name.whole.h5] [path to: project_name_mi.h5] [output_dir] [project_name] --k 2 3 4 ... </code>

The above command uses 30 as the initial parameter for visualization to change this value add the following option to the command:

<code>--perplexity 60</code>

Also, to change the default threshold for final visualization (default: 1200), add the following option:

<code>--retransformation 200</code>

### Disabling Retransformation
To surpass costly retransformation at the end of the process for visualization purposes, disable retransformation by the following option:

<code>python3 scMINER.py MICA Clust [project_name] [path_to: project_name.whole.h5] [path to: project_name_mi.h5] [output_dir] [project_name] --k 2 3 4 ... --retransformation [False|None]</code>

### Retransforming Clustering Result
To compare the visualizations in the presence or absence of retransformation, disable the retransformation on clustering and when the results are ready, use Reclust function from MICA module in scMINER as follows:

<code>python3 scMINER.py MICA Reclust [project_name] [output_dir: path where program can find the directories of the clustering result with retransformation as False] [project_name] --k 2 3 4 ... </code>

Make sure that the output directory is where the original output directories are: 
<code>[path_to]/scMINER_[project_name]/scMINER_[project_name]_out/</code>

The above command will run the retransformation setting the parameter to 1200 by default, to change this add the following option:

<code>--retransformation 200</code>

### Clustering Using Preclustering
To benefit of the previous clustering result on a dataset for specific number of clusters (k), use preclust option to surpass common calculations as follows:

<code>python3 scMINER.py MICA Clust [project_name] [path_to: project_name.whole.h5] [path to: project_name_mi.h5] [output_dir] [project_name] --k 6 7 8 ... --preclust [path_to: h5 file generated by scMINER in previous clustering (e.g. k=2)]</code>

The above command ignores <code>--perplexity</code> option since it uses preclustering transformation result.</br>

It is possible to use <code>--retransformation</code> option to change the value of the parameter for final visualization. DO NOT SET to None or False or any non-integer values.

