# scMINER
## single-cell Mutual Information Network Engineered Ranger

scMINER is a toolbox for single-cell analysis based on mutual information. This package is a combination of several individual tools including but not limited to MIE and MICA. Other tools including network construction, master regultors identification and activity based analysis may be added. MIE is the baseline of the package and the other tools require the output of MIE tool. MICA in this package has been improved and the main advantage of that is parallelism using St. Jude research cluster and Phoenix application.

## Download

<code>git clone https://github.com/jyyulab/scMINER.git</code>

## Starting Point

To start using the package on St. Jude research cluster (by default), follow the below steps:

### Phoenix Setup

In St. Jude's Research Cluster, Phoenix is accessible via:

<code>setcbenv prod</code></br>
<code>set official</code></br>
<code>cbload phoenix</code>

And the following two environment variables for scMINER:

### Setup scMINER

Set the two environment variables as follows:

<code>export PYTHON_PATH=[path_to_target_python3]</code>
</br>
<code>export scMINER_PATH=[path_to_root_directory_of_scMINER]</code>

### Setup R

To generate R plot load R module as follows:

<code>module load R/3.4.0</code>

To use the package in a regular machine, just follow Setup scMINER section and make sure to have R and requirement Python packages installed and when running any command set the --host option to LOCAL.

## Run MIE

To run MIE, simply follow the following example:

<code>$python3 scMINER.py MIE Pipeline [project_name] [input_tab_separated_file] [output_dir] [output_file_name]</code>

To avoid memory issue in case that the input file is large, make sure to use bsub on research cluster.

### Modes

#### Pipeline

##### Options

<code>--delimiter, default='tab', help='Delimiter used in the input file [tab | comma | semicolon | pipe] (default: tab)'</code></br></br>
<code>--header, default='True', help='Whether the input contains header line or not [True | False]'</code></br></br>
<code>--index_col, type=int, default=0, help='Column index to be used as row index and the starting poing of actual data [ >= 0 ] (default: 0)'</code></br></br>
<code>--slice_size, type=int, default=1000, help='Size for each slice (default: 1000)'</code></br></br>
<code>--host, default='LSF', help='Computation host of the jobs [LOCAL | LSF] (default: LSF)'</code></br></br>
<code>--resource, type=int, nargs='+', default=[2000] * 5, help='Memory allocation to each step in the following order: read, slice, calc, merge, and norm (default: 2GB)'</code></br></br>
<code>--queue, default='compbio', help='Queue name for job allocation'</code></br></br>

## Run MICA

### Clust Command
To run MICA in clustering mode, simply follow the following example:

<code>$python3 scMINER.py MICA Clust [project_name] [path_to: project_name.whole.h5] [path to: project_name_mi.h5] [output_dir] [project_name] --k 2 3 4 ... </code>

The above command uses 30 as the initial parameter for visualization to change this value add the following option to the command:

<code>--perplexity 60</code>

Also, to change the default threshold for final visualization (default: 150), add the following option:

<code>--retransformation 80</code>

#### retransformation option: Disabling Retransformation
To surpass costly retransformation at the end of the process for visualization purposes, disable retransformation by the following option:

<code>$python3 scMINER.py MICA Clust [project_name] [path_to: project_name.whole.h5] [path to: project_name_mi.h5] [output_dir] [project_name] --k 2 3 4 ... --retransformation [False|None]</code>

#### preclust option: Clustering Using Preclustering
To benefit of the previous clustering result on a dataset for specific number of clusters (k), use preclust option to surpass common calculations as follows:

<code>$python3 scMINER.py MICA Clust [project_name] [path_to: project_name.whole.h5] [path to: project_name_mi.h5] [output_dir] [project_name] --k 6 7 8 ... --preclust [path_to: h5 file generated by scMINER in previous clustering (e.g. k=2)]</code>

The above command ignores <code>--perplexity</code> option since it uses preclustering transformation result.</br>

It is possible to use <code>--retransformation</code> option to change the value of the parameter for final visualization. DO NOT SET to None or False or any non-integer values.

#### Options:

<code>--min_dim, type=int, default=19, help='Minimum number of dimensions used in clustering (default: 19)')</code></br></br>
<code>--max_dim, type=int, default=19, help='Maximum number of dimensions used in clustering (default: 19)')</code></br></br>
<code>--bootstrap, type=int, default=10, help='Maximum number of iterations per dimnesion (default: 10)')</code></br></br>
<code>--k, type=int, default=[2], nargs='+', help='Number of clusters to divide the dataset to (default: [2])')</code></br></br>
<code>--transformation, default='MDS', help='Transformation method used for dimension reduction [MDS | PCA | LPL | LPCA] (default: MDS)')</code></br></br>
<code>--hclust, default='False', help='Whether apply hierarchical clustering or not (default: False')</code></br></br>
<code>--retransformation, default=150, help='If None or False no retransformation is used in the final visualization, if a number, retransformation threshold will be set to the value (default: 150)')</code></br></br>
<code>--host, default='LSF', help='Computation host of the jobs [LOCAL | LSF] (default: LSF)')</code></br></br>
<code>--resource, type=int, nargs='+', default=[2000]*6, help='Memory allocation for each individual step in clustering pipeline (default: 2GB)')</code></br></br>
<code>--queue, default='compbio', help='Queue name for job allocation')</code></br></br>
<code>--preclust', default='None', help='Whether the clustering is based on previous clustering result or not (default: None)')</code></br></br>
<code>--perplexity', default=30, help='Visualization parameter determining how dense the clusters are')</code></br></br>

### Reclust Command: Retransforming Clustering Result
To compare the visualizations in the presence or absence of retransformation, disable the retransformation on clustering and when the results are ready, use Reclust function from MICA module in scMINER as follows:

<code>$python3 scMINER.py MICA Reclust [project_name] [output_dir: path where program can find the directories of the clustering result with retransformation as False] [project_name] --k 2 3 4 ... </code>

Make sure that the output directory is where the original output directories are: 
<code>[path_to]/scMINER_[project_name]/scMINER_[project_name]_out/</code>

The above command will run the retransformation setting the parameter to [60, 80, 100, 120, 150] by default, to change this add the following option:

<code>--retransformation 200</code>

#### Options:

<code>--transformation, default='MDS', help='Transformation method used for dimension reduction [MDS | PCA | LPL | LPCA] (default: MDS)')</code></br></br>
<code>--retransformation, nargs='+', default=[60, 80, 100, 120, 150], help='Retransformation threshold will be set to the value (default: [60, 80, 100, 120, 150])')</code></br></br>
<code>--max_dim, type=int, default=19, help='Maximum number of dimensions used in clustering (default: 19)')</code></br></br>
<code>--k, type=int, default=[2], nargs='+', help='Number of clusters to divide the dataset to (default: [2])')</code></br></br>
<code>--host, default='LSF', help='Computation host of the jobs [LOCAL | LSF] (default: LSF)')</code></br></br>
<code>--resource, type=int, nargs='+', default=[2000]*2, help='Memory allocation for each individual step in clustering pipeline (default: 2GB)')</code></br></br>
<code>--queue, default='compbio', help='Queue name for job allocation')</code></br></br>

## Run SJARACNE

<code>$python3 scMINER.py SJARACNE [project_name] [expression_file] [hub_genes_files] [out_dir]</code></br></br>

<p>By default it runs for 100 bootstraps using 10^-7 MI p-value threshold and generates consensus clustering using 10^-5 p-value threshold.</p></br>

#### Options

<code>--bootstrap, type=int, default=100, help='Number of bootstrap networks.'</code></br></br>
<code>--c_threshold, type=float, default=float('1e-5'), help='P-value threshold in building consensus network.'</code></br></br>
<code>--p_threshold, type=float, default=float('1e-7'), help='P-value threshold in building bootstrap netwroks.'</code></br></br>
<code>--depth, type=int, default=40, help='Maximum partitioning depth.'</code></br></br>
<code>--host, default='LSF', help='Computation host of the jobs [LOCAL | LSF] (default: LSF)'</code></br></br>
<code>--resource, type=int, nargs='+', default=[2000]*4, help='Memory allocation for each individual step in network construction (default: 2GB)'</code></br></br>
<code>--queue, default='compbio', help='Queue name for job allocation'</code></br></br>
